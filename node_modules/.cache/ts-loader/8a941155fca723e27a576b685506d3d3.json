{"remainingRequest":"H:\\桌面\\showtimecodeweb\\node_modules\\babel-loader\\lib\\index.js!H:\\桌面\\showtimecodeweb\\node_modules\\ts-loader\\index.js??ref--14-2!H:\\桌面\\showtimecodeweb\\src\\http\\requert.ts","dependencies":[{"path":"H:\\桌面\\showtimecodeweb\\src\\http\\requert.ts","mtime":1649511222283},{"path":"H:\\桌面\\showtimecodeweb\\babel.config.js","mtime":1642330622538},{"path":"H:\\桌面\\showtimecodeweb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1642330605221},{"path":"H:\\桌面\\showtimecodeweb\\node_modules\\babel-loader\\lib\\index.js","mtime":1642330607368},{"path":"H:\\桌面\\showtimecodeweb\\node_modules\\ts-loader\\index.js","mtime":1642330608824}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCByb3V0ZXIgZnJvbSAnQC9yb3V0ZXInOwppbXBvcnQgeyBtYXNzYWdlU2hvdyB9IGZyb20gJ0AvdXRpbHMvbWVzc2FnZUluZm8nOwppbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnOwppbXBvcnQgeyBFbExvYWRpbmcgfSBmcm9tICdlbGVtZW50LXBsdXMnOwp2YXIgbG9hZGluZzsKCnZhciBzdGFydExvYWRpbmcgPSBmdW5jdGlvbiBzdGFydExvYWRpbmcoKSB7CiAgOwogIHZhciBvcHRpb25zID0gewogICAgbG9jazogdHJ1ZSwKICAgIHRleHQ6ICLliqDovb3kuK0uLi4iLAogICAgYmFja2dyb3VuZDogJ3JnYmEoMCwwLDAsMC43KScKICB9OwogIGxvYWRpbmcgPSBFbExvYWRpbmcuc2VydmljZShvcHRpb25zKTsKfTsKCnZhciBnZXRUb2tlbiA9IGZ1bmN0aW9uIGdldFRva2VuKCkgewogIHZhciB0b2tlbiA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYWNjZXNzX3Rva2VuJyk7CiAgY29uc29sZS5sb2codG9rZW4pOwoKICBpZiAodG9rZW4gPT09IG51bGwgfHwgdG9rZW4gPT09ICcnKSB7CiAgICByZXR1cm4gZ2V0VG9rZW4oKTsKICB9IGVsc2UgewogICAgcmV0dXJuIHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYWNjZXNzX3Rva2VuJyk7CiAgfQp9OwoKdmFyIGVuZExvYWRpbmcgPSBmdW5jdGlvbiBlbmRMb2FkaW5nKCkgewogIGxvYWRpbmcuY2xvc2UoKTsKfTsgLy8g6K+35rGC5oum5oiqCgoKYXhpb3MuaW50ZXJjZXB0b3JzLnJlcXVlc3QudXNlKGZ1bmN0aW9uIChjb25maWcpIHsKICBjb25zb2xlLmxvZyhjb25maWcudXJsKTsgLy8g5Yqg6L29CgogIHN0YXJ0TG9hZGluZygpOwoKICBpZiAoY29uZmlnLnVybCAhPT0gJ2FwaS9hY2NvdW50L2xvZ2luJykgewogICAgdmFyIF9nZXRUb2tlbjsKCiAgICBjb25maWcuaGVhZGVycyA9IHsKICAgICAgQXV0aG9yaXphdGlvbjogKF9nZXRUb2tlbiA9IGdldFRva2VuKCkpICE9PSBudWxsICYmIF9nZXRUb2tlbiAhPT0gdm9pZCAwID8gX2dldFRva2VuIDogJycKICAgIH07CiAgfQoKICByZXR1cm4gY29uZmlnOwp9KTsgLy8g5ZON5bqU5oum5oiqCgpheGlvcy5pbnRlcmNlcHRvcnMucmVzcG9uc2UudXNlKGZ1bmN0aW9uIChyZXNwb25zZSkgewogIC8vIOe7k+adn2xvYWRpbmcKICBlbmRMb2FkaW5nKCk7CiAgY29uc29sZS5sb2cocmVzcG9uc2UpOyAvL+S4jeWQjOebuOW6lOaJgOe7meeahOaPkOekugoKICBpZiAocmVzcG9uc2UuZGF0YSkgewogICAgbWFzc2FnZVNob3cocmVzcG9uc2UuZGF0YS5zdGF0ZSwgcmVzcG9uc2UuZGF0YS5tYXNzYWdlKTsKICB9CgogIHJldHVybiByZXNwb25zZS5kYXRhOwp9LCBmdW5jdGlvbiAoZXJyb3IpIHsKICB2YXIgX2Vycm9yJHJlc3BvbnNlLCBfZXJyb3IkcmVzcG9uc2UyOwoKICAvLyDnu5PmnZ9sb2FkaW5nCiAgZW5kTG9hZGluZygpOwogIGNvbnNvbGUubG9nKChfZXJyb3IkcmVzcG9uc2UgPSBlcnJvci5yZXNwb25zZSkgPT09IG51bGwgfHwgX2Vycm9yJHJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZXJyb3IkcmVzcG9uc2UuaGVhZGVyc1sndG9rZW4tZXhwaXJlZCddKTsgLy/ov4fmnJ/mj5DnpLoKCiAgaWYgKCgoX2Vycm9yJHJlc3BvbnNlMiA9IGVycm9yLnJlc3BvbnNlKSA9PT0gbnVsbCB8fCBfZXJyb3IkcmVzcG9uc2UyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZXJyb3IkcmVzcG9uc2UyLmhlYWRlcnNbJ3Rva2VuLWV4cGlyZWQnXSkgPT0gJ3RydWUnKSB7CiAgICBtYXNzYWdlU2hvdygxLCAi55m75b2V6L+H5pyfIik7CiAgICB3aW5kb3cubG9jYWxTdG9yYWdlLmNsZWFyKCk7CiAgICByb3V0ZXIucHVzaCgnLycpOwogIH0gZWxzZSB7CiAgICAvLyDplJnor6/mj5DphpIKICAgIG1hc3NhZ2VTaG93KDEsIGVycm9yLm1lc3NhZ2UpOwogICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICB9Cn0pOwpleHBvcnQgZGVmYXVsdCBheGlvczs="},{"version":3,"sources":["H:\\桌面\\showtimecodeweb\\src\\http\\requert.ts"],"names":[],"mappings":";AACA,OAAO,MAAP,MAAmB,UAAnB;AACA,SAAS,WAAT,QAA4B,qBAA5B;AACA,OAAO,KAAP,MAAqE,OAArE;AACA,SAAS,SAAT,QAA0B,cAA1B;AAGA,IAAI,OAAJ;;AAEA,IAAM,YAAY,GAAG,SAAf,YAAe,GAAK;AAMvB;AAED,MAAM,OAAO,GAAY;AACvB,IAAA,IAAI,EAAE,IADiB;AAEvB,IAAA,IAAI,EAAE,QAFiB;AAGvB,IAAA,UAAU,EAAE;AAHW,GAAzB;AAKA,EAAA,OAAO,GAAG,SAAS,CAAC,OAAV,CAAkB,OAAlB,CAAV;AACD,CAdD;;AAgBA,IAAM,QAAQ,GAAG,SAAX,QAAW,GAAoB;AACnC,MAAI,KAAK,GAAkB,MAAM,CAAC,YAAP,CAAoB,OAApB,CAA4B,cAA5B,CAA3B;AACA,EAAA,OAAO,CAAC,GAAR,CAAY,KAAZ;;AACA,MAAI,KAAK,KAAK,IAAV,IAAkB,KAAK,KAAK,EAAhC,EAAoC;AAClC,WAAO,QAAQ,EAAf;AACD,GAFD,MAEO;AACL,WAAO,MAAM,CAAC,YAAP,CAAoB,OAApB,CAA4B,cAA5B,CAAP;AACD;AACF,CARD;;AASA,IAAM,UAAU,GAAG,SAAb,UAAa,GAAK;AACtB,EAAA,OAAO,CAAC,KAAR;AACD,CAFD,C,CAGA;;;AACA,KAAK,CAAC,YAAN,CAAmB,OAAnB,CAA2B,GAA3B,CAA+B,UAAC,MAAD,EAA+B;AAC5D,EAAA,OAAO,CAAC,GAAR,CAAY,MAAM,CAAC,GAAnB,EAD4D,CAE5D;;AACA,EAAA,YAAY;;AACZ,MAAI,MAAM,CAAC,GAAP,KAAe,mBAAnB,EAAwC;AAAA;;AACtC,IAAA,MAAM,CAAC,OAAP,GAAiB;AACf,MAAA,aAAa,eAAE,QAAQ,EAAV,iDAAgB;AADd,KAAjB;AAGD;;AACD,SAAO,MAAP;AACD,CAVD,E,CAaA;;AACA,KAAK,CAAC,YAAN,CAAmB,QAAnB,CAA4B,GAA5B,CAAgC,UAAC,QAAD,EAAiC;AAC/D;AACA,EAAA,UAAU;AACV,EAAA,OAAO,CAAC,GAAR,CAAY,QAAZ,EAH+D,CAI/D;;AACA,MAAI,QAAQ,CAAC,IAAb,EAAmB;AACjB,IAAA,WAAW,CAAC,QAAQ,CAAC,IAAT,CAAc,KAAf,EAAsB,QAAQ,CAAC,IAAT,CAAc,OAApC,CAAX;AACD;;AACD,SAAO,QAAQ,CAAC,IAAhB;AACD,CATD,EASG,UAAC,KAAD,EAAsB;AAAA;;AACvB;AACA,EAAA,UAAU;AACV,EAAA,OAAO,CAAC,GAAR,oBAAY,KAAK,CAAC,QAAlB,oDAAY,gBAAgB,OAAhB,CAAwB,eAAxB,CAAZ,EAHuB,CAIvB;;AACA,MAAI,qBAAA,KAAK,CAAC,QAAN,sEAAgB,OAAhB,CAAwB,eAAxB,MAA4C,MAAhD,EAAwD;AACtD,IAAA,WAAW,CAAC,CAAD,EAAI,MAAJ,CAAX;AACA,IAAA,MAAM,CAAC,YAAP,CAAoB,KAApB;AACA,IAAA,MAAM,CAAC,IAAP,CAAY,GAAZ;AACD,GAJD,MAIO;AACL;AACA,IAAA,WAAW,CAAC,CAAD,EAAI,KAAK,CAAC,OAAV,CAAX;AACA,WAAO,OAAO,CAAC,MAAR,CAAe,KAAf,CAAP;AACD;AAEF,CAxBD;AA0BA,eAAe,KAAf","sourcesContent":["\r\nimport router from '@/router';\r\nimport { massageShow } from '@/utils/messageInfo';\r\nimport axios, { AxiosError, AxiosRequestConfig, AxiosResponse } from 'axios';\r\nimport { ElLoading } from 'element-plus';\r\n\r\n\r\nlet loading: any;\r\n\r\nconst startLoading = () => {\r\n\r\n  interface Options {\r\n    lock: boolean;\r\n    text: string;\r\n    background: string;\r\n  };\r\n\r\n  const options: Options = {\r\n    lock: true,\r\n    text: \"加载中...\",\r\n    background: 'rgba(0,0,0,0.7)'\r\n  }\r\n  loading = ElLoading.service(options);\r\n}\r\n\r\nconst getToken = (): string | null => {\r\n  let token: string | null = window.localStorage.getItem('access_token')\r\n  console.log(token)\r\n  if (token === null || token === '') {\r\n    return getToken()\r\n  } else {\r\n    return window.localStorage.getItem('access_token')\r\n  }\r\n}\r\nconst endLoading = () => {\r\n  loading.close();\r\n}\r\n// 请求拦截\r\naxios.interceptors.request.use((config: AxiosRequestConfig) => {\r\n  console.log(config.url)\r\n  // 加载\r\n  startLoading();\r\n  if (config.url !== 'api/account/login') {\r\n    config.headers = {\r\n      Authorization: getToken() ?? ''\r\n    }\r\n  }\r\n  return config;\r\n})\r\n\r\n\r\n// 响应拦截\r\naxios.interceptors.response.use((response: AxiosResponse<any>) => {\r\n  // 结束loading\r\n  endLoading();\r\n  console.log(response)\r\n  //不同相应所给的提示\r\n  if (response.data) {\r\n    massageShow(response.data.state, response.data.massage)\r\n  }\r\n  return response.data;\r\n}, (error: AxiosError) => {\r\n  // 结束loading\r\n  endLoading();\r\n  console.log(error.response?.headers['token-expired'])\r\n  //过期提示\r\n  if (error.response?.headers['token-expired'] == 'true') {\r\n    massageShow(1, \"登录过期\")\r\n    window.localStorage.clear()\r\n    router.push('/')\r\n  } else {\r\n    // 错误提醒\r\n    massageShow(1, error.message)\r\n    return Promise.reject(error);\r\n  }\r\n\r\n})\r\n\r\nexport default axios;"],"sourceRoot":""}]}